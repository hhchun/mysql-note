# 查看/设置存储引擎

## 默认存储引擎

```mysql
# 查看mysql提供的存储引擎类型
show engines;
show engines \G;

# 查看默认的存储引擎
show variables like '%storage_engine%';
# 或者
SELECT @@default_storage_engine;

# 设置默认的存储引擎
SET DEFAULT_STORAGE_ENGINE=MyISAM;
```

```ini
# 修改配置文件的方式设置默认存储引擎
default-storage-engine=MyISAM

# 重启mysql服务，修改配置文件后需重启mysql才会生效
systemctl restart mysqld.service
```

## 表的存储引擎

如果在创建表的语句中没有显式指定表的存储引擎的话，那就会默认使用**mysql服务默认存储引擎**作为表的存储引擎。

* 查看表的存储引擎

  ```mysql
  SHOW CREATE TABLE 表名\G;
  ```

* 创建表时指定存储引擎

  ```mysql
  CREATE TABLE 表名( 
      建表语句; 
  ) ENGINE = 存储引擎名称;
  ```

* 修改表的存储引擎

  ```mysql
  ALTER TABLE 表名 ENGINE = 存储引擎名称;
  ```

# 存储引擎类型

## InnoDB

* 具备外键支持功能的事务存储引擎。

* 从MySQL3.23.34a开始支持InnoDB存储引擎。在MySQL5.5之后，InnoDB为默认存储引擎。

* InnoDB是MySQL的默认事务存储引擎，它被设计用来处理大量的短期(short-lived)事务。可以确保事务的完整提交(Commit)和回滚(Rollback)。

* InnoDB在处理巨大数据量有很大的优化，因此InnoDB是**为处理巨大数据量的最大性能设计**。

* 对比MyISAM存储引擎：

  * InnoDB支持事务、行锁，MyISAM只支持表锁。

  * InnoDB在进行操作时效率比MyISAM差，因为InnoDB寻址是映射到块再到行，而MyISAM是直接到文件的OFFSET；InnoDB还要维护MVCC（多版本并发控制）一致，虽然一些场景没有，但InnoDB还是需要去检查和维护的。

  * InnoDB用于存储数据和索引的磁盘大小比MyISAM大，因为MyISAM进行了数据压缩。

  * InnoDB对内存要求较高，内存大小对性能有决定性的影响。因为MyISAM只缓存索引，不缓存真实数据；InnoDB不仅缓存索引还缓存真实数据。

    | 对比项         | MyISAM                                                   | InnoDB                                                       |
    | -------------- | -------------------------------------------------------- | ------------------------------------------------------------ |
    | 外键           | 不支持                                                   | 支持                                                         |
    | 事务           | 不支持                                                   | 支持                                                         |
    | 行表锁         | 表锁，即使操作一条记录也会锁住整个表，不适合高并发的操作 | 行锁，操作时只锁某一行，不对其它行有影响，适合高并发的操作   |
    | 缓存           | 只缓存索引，不缓存真实数据                               | 不仅缓存索引还要缓存真实数据，对内存要求较高，而且内存大小对性能有决定性的影响 |
    | 自带系统表使用 | 是                                                       | 否                                                           |
    | 关注点         | 性能：节省资源、消耗少、简单业务                         | 事务：并发写、事务、更大资源                                 |
    | 默认安装       | 是                                                       | 是                                                           |
    | 默认使用       | 否                                                       | 是                                                           |

## MyISAM

* 不支持事务、行锁、外键；崩溃后无法进行数据安全恢复。
* MySQL5.5之前默认的存储引擎。
* 优势：访问速度快；对事务完整性无要求或以SELECT、INSERT为主的，推荐使用MyISAM。
* count(*)的查询效率很高，因为针对数据统计有额外的常量进行存储。

## Memory

* Memory采用的逻辑介质是**内存** ， **响应速度快** ，但是当mysqld守护进程崩溃的时候**数据会丢失** 。另外，要求存储的数据是**数据长度不变**的格式，比如，Blob和Text类型的数据不可用(长度不固定的)。
* Memory同时**支持哈希（HASH）索引** 和**B+树索引** 。
* MEMORY **表的大小是受到限制**的。表的大小主要取决于两个参数，分别是**max_rows**和**max_heap_table_size**。其中，max_rows可以在创建表时指定；max_heap_table_size的大小默认为16MB，可以按需要进行扩大。
* 数据文件和索引文件是分开存储的。表结构描述信息是存储在磁盘中数据库对应的目录下，文件名为：表名.frm ，数据存储在内存中。
* 适用的场景：目标数据量小、操作访问频繁的数据、临时的数据、立即可用的数据。

## Archive

* 基本上用于数据归档；数据压缩比非常的高，存储空间大概是innodb的十分之一和十五分之一。

* 因为不支持索引、缓存索引和数据，所以并不适合并发访问。

* Archive使用行锁来实现高并发插入操作，但是它不支持事务，其设计目标只是提供高速的插入和压缩功能。

  | 特征                                                      | 支持         |
  | --------------------------------------------------------- | ------------ |
  | B树泰引                                                   | 不支持       |
  | **备份/时间点恢复**（在服务器中实现，而不是在存储引擎中） | 支持         |
  | 集群数据库支持                                            | 不支持       |
  | 聚集素引                                                  | 不支持       |
  | **压缩数据**                                              | 支持         |
  | 数据缓存                                                  | 不支持       |
  | 加密数据（加密功能在服务器中实现）                        | 支持         |
  | 外键支持                                                  | 不支持       |
  | 全文检素素引                                              | 不支持       |
  | 地理空间数据类型支持                                      | 支持         |
  | 地理空间索引支持                                          | 不支持       |
  | 哈希索引                                                  | 不支持       |
  | 索引缓存                                                  | 不支持       |
  | **锁粒度**                                                | 行锁         |
  | MVCC                                                      | 不支持       |
  | 存储限制                                                  | 没有任何限制 |
  | 事务                                                      | 不支持       |
  | **更新数据字典的統计信息**                                | 支持         |

## Blackhole

丢弃写操作，读操作会返回空内容；作用：未知。

## CSV

* 一般用于存储Excel数据。

* 在创建CSV表时都会在数据库目录下创建**表名.CSM**和**表名.CSV**两个文件，CSM文件（元文件）存储的是表元数据信息（表的状态、表中存在的行数）；CSV文件存储的是数据，每列数据以逗号隔开。如：

  ```tex
  "1","record one" 
  "2","record two"
  ```

* CSV文件被表格应用读取，甚至写入。

## 其它存储引擎

*  Federated：Federated引擎是访问其他MySQL服务器的一个**代理** ，尽管该引擎看起来提供了一种很好的**跨服务器的灵活性** ，但也经常带来问题，因此**默认是禁用的** 。
*  Merge：管理多个MyISAM表构成的表集合。
*  NDB：MySQL集群专用存储引擎。也叫做 NDB Cluster 存储引擎，主要用于**MySQL Cluster 分布式集群**环境，类似于 Oracle 的 RAC 集群。

## InnoDB不为人知的秘密

* 自适应哈希索引：InnoDB会监控对表上各索引页的查询，如果观察该数据被访问的频次符合规则，那么就建立哈希索引来加快数据访问的速度，这个哈希索引称之为"**Adaptive Hash Index,AHI**",AHI是通过缓冲池的B+树页构建的，建立的速度很快，而且不对整颗树都建立哈希索引。(可以理解成热点的数据才会进入这个哈希表)