# 优化步骤

![image-20220325175937136](https://revenge-img.oss-cn-guangzhou.aliyuncs.com/img/image-20220325175937136.png)

> 整个流程划分成了观察（Show status）和行动（Action）两个部分。
>
> 字母 S 的部分代表观察（会使用相应的分析工具），字母 A 代表的部分是行动（对应分析可以采取的行动）。

![image-20220325180029352](https://revenge-img.oss-cn-guangzhou.aliyuncs.com/img/image-20220325180029352.png)

> 目标：最低的成本达到最高的效果。

# 查看系统性能参数

```mysql
# 查看 性能参数、执行频率
SHOW [GLOBAL|SESSION] STATUS LIKE'参数';
```

常用的性能参数：

| 参数                 | 说明                                   |
| -------------------- | -------------------------------------- |
| Connections          | 连接MySQL服务器的次数                  |
| Uptime               | MySQL服务器的上线时间                  |
| Slow_queries         | 慢查询的次数                           |
| Innodb_rows_read     | Select查询返回的行数                   |
| Innodb_rows_inserted | 执行INSERT操作插入的行数               |
| Innodb_rows_updated  | 执行UPDATE操作更新的行数               |
| Innodb_rows_deleted  | 执行DELETE操作删除的行数               |
| Com_select           | 查询操作的次数                         |
| Com_insert           | 插入操作的次数。批量插入，只累加一次。 |
| Com_update           | 更新操作的次数                         |
| Com_delete           | 删除操作的次数                         |

# 统计查询成本

一条SQL查询语句在执行前需要确定查询执行计划，如果存在多种执行计划的话，MySQL会计算每个执行计划所需要的成本，从中选择**成本最小**的一个作为最终执行的执行计划。

```mysql
# 在执行查询sql之后执行,值的单位为数据页
SHOW STATUS LIKE 'last_query_cost';
```

> 使用场景：对于比较开销是非常有用的，特别是有好几种查询方式可选的时候。
>
> 注意：查询的时间差不多一样，但查询成本可能会存在很大的差距。

# 定位慢SQL

1. 开启慢查询日志
2. 查看慢查询数目
3. 慢查询日志分析工具
4. 关闭慢查询日志
5. 删除慢查询日志

# 查看慢SQL执行成本

# 分析查询

# 分析优化器执行计划

# 监控分析视图